webpackJsonp([7],{"9CGP":function(s,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",[t("h2",{attrs:{id:"小程序架构"}},[s._v("小程序架构")]),s._v(" "),t("p",[s._v("本人并没有成熟的小程序开发经验，如有错误请斧正，但是我相信原理应该是这样。"),t("br"),s._v("\n我们可以想像在一个 app 内如何实现小程序。")]),s._v(" "),t("ul",[t("li",[s._v("app 提供一个 "),t("code",{pre:!0},[s._v("纯 js 执行环境")]),s._v("，并注入 JSSDK 即 "),t("code",{pre:!0},[s._v("纯 js 执行环境")]),s._v(" 与 native 通信。")]),s._v(" "),t("li",[s._v("创建 active，内部有一个 "),t("code",{pre:!0},[s._v("webview")]),s._v(" 组件，让 "),t("code",{pre:!0},[s._v("纯 js 执行环境")]),s._v(" 可以和 "),t("code",{pre:!0},[s._v("webview")]),s._v(" 相互通信。(todo)")]),s._v(" "),t("li",[t("code",{pre:!0},[s._v("webview")]),s._v(" 可以和 "),t("code",{pre:!0},[s._v("native")]),s._v(" 通信。比如 "),t("code",{pre:!0},[s._v("webview")]),s._v(" 需要渲染一个 native 组件（取决于 wxml 结构)，"),t("code",{pre:!0},[s._v("webview")]),s._v(" 通知 native 去渲染一个 "),t("code",{pre:!0},[s._v("native 组件")]),s._v(" 覆盖在 "),t("code",{pre:!0},[s._v("webview")]),s._v(" 上，并注册对 "),t("code",{pre:!0},[s._v("native 组件")]),s._v(" 事件的监听 （取决于 wxml 是否监听了）。")])]),s._v(" "),t("p",[s._v("总体来看，就是 "),t("code",{pre:!0},[s._v("纯 js 执行环境")]),s._v(" 只负责数据和逻辑，"),t("code",{pre:!0},[s._v("webview")]),s._v(" 只负责 UI （包括UI事件的通知和渲染）。"),t("code",{pre:!0},[s._v("纯 js 执行环境")]),s._v(" 和 native 及 "),t("code",{pre:!0},[s._v("webview")]),s._v(" 可以通信；"),t("code",{pre:!0},[s._v("webview")]),s._v(" 可以和 native 通信。两者与 native 通信的职责不同，前者是获取 native 的 api 能力，后者是 UI 能力。")]),s._v(" "),t("blockquote",[t("p",[s._v("这里及以下 "),t("code",{pre:!0},[s._v("native 组件")]),s._v(" 代指 非 webview 组件")])]),s._v(" "),t("p",[s._v("todo 确定 "),t("code",{pre:!0},[s._v("webview")]),s._v(" 执行监听回掉是同步执行还是异步执行")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://developers.weixin.qq.com/ebook?action=get_post_info&token=935589521&volumn=1&lang=zh_CN&book=miniprogram&docid=0008aeea9a8978ab0086a685851c0a"}},[s._v("小程序开发指南")])]),s._v(" "),t("p",[t("strong",[s._v("解析：")])]),s._v(" "),t("p",[s._v("我们可以回想小程序是页面需要 "),t("code",{pre:!0},[s._v("wxml")]),s._v(" "),t("code",{pre:!0},[s._v("js")]),s._v(" "),t("code",{pre:!0},[s._v("wxss")]),s._v(" "),t("code",{pre:!0},[s._v("json")]),s._v(" 。我们先忽略 "),t("code",{pre:!0},[s._v("wxss")]),s._v(" "),t("code",{pre:!0},[s._v("json")]),s._v(" 及 "),t("code",{pre:!0},[s._v("API")]),s._v(" 能力，"),t("code",{pre:!0},[s._v("wxss")]),s._v(" "),t("code",{pre:!0},[s._v("json")]),s._v(" 无非是告知渲染样式和一些配置，可能是 "),t("code",{pre:!0},[s._v("native 组件")]),s._v(" 的渲染也可能是 "),t("code",{pre:!0},[s._v("webview")]),s._v(" 中 h5 原生 dom，"),t("code",{pre:!0},[s._v("API")]),s._v(" 能力无非也是 Native 提供给 jscore 的一个 bridge （jssdk），因此这两部分可以看作是黑盒。只看 "),t("code",{pre:!0},[s._v("wxml")]),s._v(" "),t("code",{pre:!0},[s._v("js")]),t("br"),s._v("\n首先 "),t("code",{pre:!0},[s._v("wxml")]),s._v(" 可以理解为模版引擎，用于告知 "),t("code",{pre:!0},[s._v("native")]),s._v(" 页面 如何渲染 webview 和 native 组件，由于使用了模版，底层逃不开 MVVM 的思想。当 webview js引擎 接收到 data 变化会根据模版计算的结果重新渲染（至于内部是否使用了 vdom diff 这里可以不用管），当接收到了 UI 事件会去执行 "),t("code",{pre:!0},[s._v("纯 js 执行环境")]),s._v(" 注册的监听函数。"),t("br"),s._v("\n其次 "),t("code",{pre:!0},[s._v("js")]),s._v(" 会响应事件（生命周期及 UI 事件），在相应方法里操作 setData。那么对于开发者来说除了有效的 "),t("code",{pre:!0},[s._v("wxml")]),s._v(" 布局设计外，合理使用 setData 就尤为关键了。"),t("br"),s._v("\nsetData 内部会同步更新 data，并将 参数 传递给 webview，由于涉及到通信肯定是 异步。那么 webview 拿到参数，计算新的布局并渲染。"),t("br"),s._v("\n根据微信的文档，异步将 参数 传递给 webview 肯定是 宏队列。比如我们连续 setData 两次，那么第一次拿到 参数，计算布局、渲染。由于此时 webview 中 js引擎在执行第一次通信的结果，第二次通信被挂起（放在新的宏队列里）。")]),s._v(" "),t("p",[s._v("问题：")]),s._v(" "),t("ol",[t("li",[s._v("第一次拿到 参数，计算布局，然后执行渲染，如果此时 第二次通信还未被放到宏队列则会触发渲染。但如果已经放在宏队列里，理论上会继续计算布局，最后进行一次渲染")]),s._v(" "),t("li",[s._v("webview 如何执行 监听的回掉？")])]),s._v(" "),t("p",[s._v("思考：")]),s._v(" "),t("p",[t("code",{pre:!0},[s._v("纯 js 执行环境")]),s._v(" 与 "),t("code",{pre:!0},[s._v("webview")]),s._v(" 通信除了需要 "),t("code",{pre:!0},[s._v("webview")]),s._v(" js引擎空闲，还需要渲染完成才能被执行？")]),s._v(" "),t("p",[s._v("待调研：")]),s._v(" "),t("ol",[t("li",[s._v("父组件（页面）setData ，子组件此时单纯修改数据是否会渲染")]),s._v(" "),t("li",[s._v("父组件（页面）与子组件同时调用 setData 会重复渲染吗？")]),s._v(" "),t("li",[s._v("父组件（页面）setData，子组件 使用了上级 data 作为其 props，并代理了这个 props（代理内 setData）会在上级 setData 完成前还是完成后调用")])]),s._v(" "),t("p",[s._v("完成前调用那么（其实好像没有必要）")]),s._v(" "),t("h2",{attrs:{id:"问题"}},[s._v("问题")]),s._v(" "),t("p",[s._v("小程序不像 Vue，将 Vue 构造函数暴露给开发者，而是提供 类似 App，Page 这样的方法创建。但是方式很接近，都是传入一个 Options。相信很多开发者以为自己在写 Vue 实例，其实是在写 Options")]),s._v(" "),t("ol",[t("li",[s._v("data 初始化时，和 Vue 一样，会去拿到新的 data，只是前者依靠 JSON 化（或者深克隆，反正官方文档是说可 JSON 序列化对象），后者则是遍历 生成 Watcher 实例")])]),s._v(" "),t("p",[s._v("这就意味着我们还不能直接返回一个 Observable 数据给 data，而应该在 onLoad 时去给 data 重新赋值")]),s._v(" "),t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-js"}},[t("span",{attrs:{class:"hljs-comment"}},[s._v("/*\nsetData 主流程精简还原，并非完整主流程，内有注释\n*/")]),s._v("\n"),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{attrs:{class:"hljs-title"}},[s._v("setData")]),s._v(" ("),t("span",{attrs:{class:"hljs-params"}},[s._v("obj")]),s._v(") ")]),s._v("{\n    "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{attrs:{class:"hljs-keyword"}},[s._v("typeof")]),s._v("(obj) !== "),t("span",{attrs:{class:"hljs-string"}},[s._v("'Object'")]),s._v(") {\n        "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),t("span",{attrs:{class:"hljs-string"}},[s._v("'类型错误'")]),s._v("); "),t("span",{attrs:{class:"hljs-comment"}},[s._v("// 并没有预期中的return;")]),s._v("\n    }\n    "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" type = "),t("span",{attrs:{class:"hljs-string"}},[s._v("'appDataChange'")]),s._v(";\n\n    "),t("span",{attrs:{class:"hljs-comment"}},[s._v("// u.default.emit(e, this.__wxWebviewId__) 代码还原")]),s._v("\n    "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" e = [type, {\n                "),t("span",{attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": list},\n                "),t("span",{attrs:{class:"hljs-attr"}},[s._v("options")]),s._v(": {"),t("span",{attrs:{class:"hljs-attr"}},[s._v("timestamp")]),s._v(": +"),t("span",{attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("Date")]),s._v("()}\n            },\n            ["),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v("] "),t("span",{attrs:{class:"hljs-comment"}},[s._v("// this.__wxWebviewId__")]),s._v("\n    }];\n\n    "),t("span",{attrs:{class:"hljs-comment"}},[s._v("// WeixinJSBridge.publish.apply(WeixinJSBridge, e); 代码还原")]),s._v("\n    "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" datalength = "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("JSON")]),s._v(".stringify(e.data).length;  "),t("span",{attrs:{class:"hljs-comment"}},[s._v("// 第一次 JSON.stringify")]),s._v("\n    "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (datalength > AppserviceMaxDataSize) { "),t("span",{attrs:{class:"hljs-comment"}},[s._v("// AppserviceMaxDataSize === 1048576")]),s._v("\n        "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".error("),t("span",{attrs:{class:"hljs-string"}},[s._v("'已经超过最大长度'")]),s._v(");\n        "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(";\n    }\n\n    "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (type === "),t("span",{attrs:{class:"hljs-string"}},[s._v("'appDataChange'")]),s._v(" || type === "),t("span",{attrs:{class:"hljs-string"}},[s._v("'pageInitData'")]),s._v(" || type === "),t("span",{attrs:{class:"hljs-string"}},[s._v("'__updateAppData'")]),s._v(") {\n\n        "),t("span",{attrs:{class:"hljs-comment"}},[s._v('// sendMsgToNW({appData: __wxAppData, sdkName: "send_app_data"}) 代码还原')]),s._v("\n        __wxAppData = {\n            "),t("span",{attrs:{class:"hljs-string"}},[s._v("'pages/page1/page1'")]),s._v(": alldata\n        }\n        e = { "),t("span",{attrs:{class:"hljs-attr"}},[s._v("appData")]),s._v(": __wxAppData, "),t("span",{attrs:{class:"hljs-attr"}},[s._v("sdkName")]),s._v(": "),t("span",{attrs:{class:"hljs-string"}},[s._v('"send_app_data"')]),s._v(" }\n\n        "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" postdata = "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("JSON")]),s._v(".parse("),t("span",{attrs:{class:"hljs-built_in"}},[s._v("JSON")]),s._v(".stringify(e)); "),t("span",{attrs:{class:"hljs-comment"}},[s._v("// 第二次 JSON.stringify 第一次 JSON.parse")]),s._v("\n        "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".postMessage({\n            postdata\n        }, "),t("span",{attrs:{class:"hljs-string"}},[s._v('"*"')]),s._v(");\n    }\n\n\n    "),t("span",{attrs:{class:"hljs-comment"}},[s._v('// sendMsgToNW({appData: __wxAppData, sdkName: "send_app_data"}) 代码还原')]),s._v("\n    e = {\n        "),t("span",{attrs:{class:"hljs-attr"}},[s._v("eventName")]),s._v(": type,\n        "),t("span",{attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": e["),t("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v("],\n        "),t("span",{attrs:{class:"hljs-attr"}},[s._v("webviewIds")]),s._v(": ["),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v("],\n        "),t("span",{attrs:{class:"hljs-attr"}},[s._v("sdkName")]),s._v(": "),t("span",{attrs:{class:"hljs-string"}},[s._v("'publish'")]),s._v("\n    };\n\n    "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" postdata = "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("JSON")]),s._v(".parse("),t("span",{attrs:{class:"hljs-built_in"}},[s._v("JSON")]),s._v(".stringify(e));  "),t("span",{attrs:{class:"hljs-comment"}},[s._v("// 第三次 JSON.stringify 第二次 JSON.parse")]),s._v("\n    "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".postMessage({\n        postdata\n    }, "),t("span",{attrs:{class:"hljs-string"}},[s._v('"*"')]),s._v(");\n}\n"),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{attrs:{class:"hljs-params"}},[s._v("e, t")]),s._v(") ")]),s._v("{\n  "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("try")]),s._v(" {\n      "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" n = ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n      a.getDataType)(e);\n      "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{attrs:{class:"hljs-string"}},[s._v('"Object"')]),s._v(" !== n)\n          "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("void")]),s._v(" ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n          a.error)("),t("span",{attrs:{class:"hljs-string"}},[s._v('"类型错误"')]),s._v(", "),t("span",{attrs:{class:"hljs-string"}},[s._v('"setData accepts an Object rather than some "')]),s._v(" + n);\n      "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" o "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" e) {\n          "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("void")]),s._v(" "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" === e[o] && ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n          a.error)("),t("span",{attrs:{class:"hljs-string"}},[s._v('"Page setData warning"')]),s._v(", "),t("span",{attrs:{class:"hljs-string"}},[s._v("'Setting data field \"'")]),s._v(" + o + "),t("span",{attrs:{class:"hljs-string"}},[s._v("'\" to undefined is invalid.'")]),s._v(");\n          "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" r = ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n          u.getObjectByPath)("),t("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".data, o)\n            , i = r.obj\n            , s = r.key;\n          i && (i[s] = ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n          f.default)(e[o]))\n      }\n      c.default.emit({\n          "),t("span",{attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": e\n      }, "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".__wxWebviewId__, t)\n  } "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("catch")]),s._v(" (e) {\n      ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n      a.errorReport)(e)\n  }\n}\n\nf.default\n"),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{attrs:{class:"hljs-title"}},[s._v("r")]),s._v("("),t("span",{attrs:{class:"hljs-params"}},[s._v("e")]),s._v(") ")]),s._v("{\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" t = "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v(".length > "),t("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v(" && "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("void")]),s._v(" "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" !== "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v("["),t("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v("] ? "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v("["),t("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v("] : o;\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(" === e)\n                "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(";\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" n = ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n            u.copyValue)(e);\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(" !== n)\n                "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" n;\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" r = ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n            u.copyCollection)(e, t)\n              , a = "),t("span",{attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(" !== r ? r : e;\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" i(e, t, a, [e], [a])\n        }\nt.getObjectByPath = "),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{attrs:{class:"hljs-params"}},[s._v("e, t")]),s._v(") ")]),s._v("{\n\n  "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" n = r(t), i = {}, a = "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("void")]),s._v(" "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", u = e, s = "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v("; s < n.length; s++)\n      "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("Number")]),s._v("(n[s]) === n[s] && n[s] % "),t("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v(" == "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" ? "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("Array")]),s._v(".isArray(u) || (i[a] = [],\n      u = i[a]) : ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n      o.isPlainObject)(u) || (i[a] = {},\n      u = i[a]),\n      a = n[s],\n      i = u,\n      u = u[n[s]];\n  "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" {\n      "),t("span",{attrs:{class:"hljs-attr"}},[s._v("obj")]),s._v(": i,\n      "),t("span",{attrs:{class:"hljs-attr"}},[s._v("key")]),s._v(": a\n  }\n}\n")])]),s._v(" "),t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-js"}},[t("span",{attrs:{class:"hljs-comment"}},[s._v("// setData")]),s._v("\n"),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{attrs:{class:"hljs-params"}},[s._v("state, callback")]),s._v(") ")]),s._v("{\n  "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("try")]),s._v(" {\n      "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" type = ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", a.getDataType)(state);\n      "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{attrs:{class:"hljs-string"}},[s._v('"Object"')]),s._v(" !== type)\n          "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("void")]),s._v(" ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", a.error)("),t("span",{attrs:{class:"hljs-string"}},[s._v('"类型错误"')]),s._v(", "),t("span",{attrs:{class:"hljs-string"}},[s._v('"setData accepts an Object rather than some "')]),s._v(" + type);\n      "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" key "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" state) {\n          "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("void")]),s._v(" "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" === state[key] && ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", a.error)("),t("span",{attrs:{class:"hljs-string"}},[s._v('"Page setData warning"')]),s._v(", "),t("span",{attrs:{class:"hljs-string"}},[s._v("'Setting data field \"'")]),s._v(" + o + "),t("span",{attrs:{class:"hljs-string"}},[s._v("'\" to undefined is invalid.'")]),s._v(");\n          "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" r = ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", u.getObjectByPath)("),t("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".data, key)\n          "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" data = r.obj\n          "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" s = r.key;\n          data && (data[s] = ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", f.default)(state[key]))\n      }\n      c.default.emit({\n          "),t("span",{attrs:{class:"hljs-attr"}},[s._v("data")]),s._v(": state\n      }, "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".__wxWebviewId__, t)\n  } "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("catch")]),s._v(" (e) {\n      ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n      a.errorReport)(e)\n  }\n}\n\nf.default\n"),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),t("span",{attrs:{class:"hljs-title"}},[s._v("r")]),s._v("("),t("span",{attrs:{class:"hljs-params"}},[s._v("e")]),s._v(") ")]),s._v("{\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" t = "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v(".length > "),t("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v(" && "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("void")]),s._v(" "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" !== "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v("["),t("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v("] ? "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("arguments")]),s._v("["),t("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v("] : o;\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(" === e)\n                "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(";\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" n = ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n            u.copyValue)(e);\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),t("span",{attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(" !== n)\n                "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" n;\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" r = ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n            u.copyCollection)(e, t)\n              , a = "),t("span",{attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(" !== r ? r : e;\n            "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" i(e, t, a, [e], [a])\n        }\nt.getObjectByPath = "),t("span",{attrs:{class:"hljs-function"}},[t("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),t("span",{attrs:{class:"hljs-params"}},[s._v("pageData, key")]),s._v(") ")]),s._v("{\n\n  "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),t("span",{attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" n = r(key), i = {}, a = "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("void")]),s._v(" "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(", u = pageData, s = "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v("; s < n.length; s++)\n      "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("Number")]),s._v("(n[s]) === n[s] && n[s] % "),t("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v(" == "),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(" ? "),t("span",{attrs:{class:"hljs-built_in"}},[s._v("Array")]),s._v(".isArray(u) || (i[a] = [],\n      u = i[a]) : ("),t("span",{attrs:{class:"hljs-number"}},[s._v("0")]),s._v(",\n      o.isPlainObject)(u) || (i[a] = {},\n      u = i[a]),\n      a = n[s],\n      i = u,\n      u = u[n[s]];\n  "),t("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" {\n      "),t("span",{attrs:{class:"hljs-attr"}},[s._v("obj")]),s._v(": i,\n      "),t("span",{attrs:{class:"hljs-attr"}},[s._v("key")]),s._v(": a\n  }\n}\n")])]),s._v(" "),t("p",[s._v("todo")]),s._v(" "),t("ol",[t("li",[s._v("组件和父页面同步 setData 渲染次数？ 查看回调是否在一次事件循环（一方面两次同步 invoke 导致回调异步）所以除了微队列判断外还需要 performance")]),s._v(" "),t("li",[s._v("trigger 是同步还是异步？虽然很好实现同步，但是文档说模拟组件事件，而且还可以冒泡")]),s._v(" "),t("li",[s._v("子组件感知 props 变化是同步还是异步？")])]),s._v(" "),t("ul",[t("li",[s._v("组件和父页面同步 setData 渲染次数是 1次，基本可以放心同步 setData，毕竟两个不同实例，无法一次 setData")]),s._v(" "),t("li",[s._v("如果 trigger 是异步有必要实现成同步吗？")]),s._v(" "),t("li",[s._v("如果 感知 props 变化是异步，有必要实现成同步吗？")]),s._v(" "),t("li",[s._v("如何拿到 Page/App/Component.prototype")])])])}]},v=t("VU/8")(null,n,!1,null,null,null);a.default=v.exports},W9Qr:function(s,a,t){s.exports=t("9CGP")}});
//# sourceMappingURL=7.f41dc77f8ab2fc34578e.js.map