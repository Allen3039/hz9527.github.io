webpackJsonp([6],{M4Yh:function(s,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={render:function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("section",[a("div",{staticClass:"aside-menu"},[a("div",{directives:[{name:"toggle",rawName:"v-toggle"}],staticClass:"aside-menu-tit"}),s._m(0)]),a("h2",{attrs:{id:"%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AApromise-1"}},[s._v("实现一个promise")]),s._v(" "),a("p",[a("b",{staticClass:"update-time"},[s._v(s._s(s._f("formatTime")(1542100282249)))]),s._v(" "),a("b",{staticClass:"type"},[s._v("js")]),s._v(" "),a("b",{staticClass:"kw"},[s._v("promise")]),s._v(" "),a("b",{staticClass:"kw"},[s._v("promise实现")])]),s._v(" "),s._m(1),s._v(" "),a("h3",{attrs:{id:"promise%E5%9F%BA%E7%A1%80-1"}},[s._v("promise基础")]),s._v(" "),s._m(2),s._v(" "),a("h3",{attrs:{id:"%E6%80%9D%E8%80%83%E5%87%A0%E4%B8%AA%E9%97%AE%E9%A2%98-1"}},[s._v("思考几个问题")]),s._v(" "),s._m(3),s._v(" "),a("p",[s._v("用以下demo来简单解答这几个问题")]),s._v(" "),s._m(4),s._v(" "),a("h3",{attrs:{id:"promise%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%9F%BA%E7%A1%80%E5%AE%9E%E7%8E%B0-1"}},[s._v("Promise构造函数基础实现")]),s._v(" "),s._m(5),s._v(" "),s._m(6),s._v(" "),s._m(7),s._v(" "),s._m(8),s._v(" "),s._m(9),s._v(" "),s._m(10),s._v(" "),s._m(11),s._v(" "),a("p",[s._v("接下来就是then的实现了，注意以下几点：")]),s._v(" "),s._m(12),s._v(" "),s._m(13),s._v(" "),a("p",[s._v("promise构造函数基本框架已完成，接下来就是异步、catch错误及catch、finally实现")]),s._v(" "),s._m(14),s._v(" "),s._m(15),s._v(" "),a("p",[s._v("然后就是构造函数方法的实现Promise.resolve,Promise.reject,Promise.all,Promise.race及一些校验")]),s._v(" "),s._m(16),s._v(" "),s._m(17),s._v(" "),s._m(18),s._v(" "),a("p",[s._v("那么思考下如何实现一个更为严谨的promise构造函数")]),s._v(" "),a("h3",{attrs:{id:"promise%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E8%BF%9B%E9%98%B6%E5%AE%9E%E7%8E%B0-1"}},[s._v("Promise构造函数进阶实现")]),s._v(" "),a("p",[s._v("test")])])},staticRenderFns:[function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"aside-menu-con"},[t("a",{staticClass:"level-2 aside-menu-item",attrs:{href:"#%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AApromise-1"}},[this._v("实现一个promise")]),t("a",{staticClass:"level-3 aside-menu-item",attrs:{href:"#promise%E5%9F%BA%E7%A1%80-1"}},[this._v("promise基础")]),t("a",{staticClass:"level-3 aside-menu-item",attrs:{href:"#%E6%80%9D%E8%80%83%E5%87%A0%E4%B8%AA%E9%97%AE%E9%A2%98-1"}},[this._v("思考几个问题")]),t("a",{staticClass:"level-3 aside-menu-item",attrs:{href:"#promise%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%9F%BA%E7%A1%80%E5%AE%9E%E7%8E%B0-1"}},[this._v("Promise构造函数基础实现")]),t("a",{staticClass:"level-3 aside-menu-item",attrs:{href:"#promise%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E8%BF%9B%E9%98%B6%E5%AE%9E%E7%8E%B0-1"}},[this._v("Promise构造函数进阶实现")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[t("code",{pre:!0},[this._v("Promise")]),this._v(" 大概是前端开发者非常常用的函数之一，除了使用它，是否考虑过自己实现一个简单的 "),t("code",{pre:!0},[this._v("Promise")]),this._v(" 构造函数？")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ol",[t("li",[this._v("new Promise")]),this._v(" "),t("li",[this._v("Promise.resolve Promise.reject")]),this._v(" "),t("li",[this._v("Promise.all Promise.race Promise.try")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ol",[a("li",[s._v("Promise函数参数的执行是同步还是异步？")]),s._v(" "),a("li",[s._v("Promise.prototype.then/catch返回？")]),s._v(" "),a("li",[s._v("如果返回本身就是一个Promise，那么是否会产生两次异步？")]),s._v(" "),a("li",[s._v("resolve后代码报错是否会被catch？")]),s._v(" "),a("li",[s._v("Promise未执行的then／catch行为？")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("pre",{pre:!0},[a("code",{attrs:{"v-pre":"",class:"language-JavaScript"}},[a("span",{attrs:{class:"hljs-comment"}},[s._v("// Promise函数参数的执行是同步还是异步？")]),s._v("\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 这将决定我们如何设计异步")]),s._v("\n"),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),a("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v(")\n"),a("span",{attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("Promise")]),s._v("("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" {\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),a("span",{attrs:{class:"hljs-number"}},[s._v("2")]),s._v(")\n  r()\n}).then("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),a("span",{attrs:{class:"hljs-number"}},[s._v("3")]),s._v("))\n"),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),a("span",{attrs:{class:"hljs-number"}},[s._v("4")]),s._v(")\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 1 2 4 3")]),s._v("\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("/** Promise函数参数是同步的 */")]),s._v("\n\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// Promise.prototype.then/catch返回？")]),s._v("\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 这将决定我们如何设计then／catch返回")]),s._v("\n"),a("span",{attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("Promise")]),s._v("("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" {\n  r()\n}).then("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" {\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),a("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v(")\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("Promise")]),s._v(".resolve("),a("span",{attrs:{class:"hljs-number"}},[s._v("2")]),s._v(").then("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(r)) "),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 如果 2 先 log 证明 then 返回一个异步函数")]),s._v("\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"hljs-number"}},[s._v("3")]),s._v("\n}).then("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" {\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("Promise")]),s._v(".resolve("),a("span",{attrs:{class:"hljs-number"}},[s._v("4")]),s._v(").then("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" r).then("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(r)) "),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 如果 4 先 log 证明 then fn 返回 promise 不会覆盖原 promise")]),s._v("\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(r)\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("Promise")]),s._v(".resolve("),a("span",{attrs:{class:"hljs-number"}},[s._v("5")]),s._v(")\n}).then("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(r))\n"),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),a("span",{attrs:{class:"hljs-number"}},[s._v("6")]),s._v(")\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 6 1 2 3 4 5")]),s._v("\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("/** Promise.prototype.then/catch返回同样是异步函数（新的Promise）*/")]),s._v("\n\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// resolve后代码报错是否会被catch？")]),s._v("\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 这将决定我们如何设计try catch")]),s._v("\n"),a("span",{attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("Promise")]),s._v("("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" {\n  r()\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("throw")]),s._v(" "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("Error")]),s._v("("),a("span",{attrs:{class:"hljs-string"}},[s._v("'there has a error'")]),s._v(")\n}).then("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" {\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),a("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v(")\n}).catch("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("e")]),s._v(" =>")]),s._v(" {\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),a("span",{attrs:{class:"hljs-number"}},[s._v("2")]),s._v(", e)\n})\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 1")]),s._v("\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("/** resolve后的错误并不会被catch */")]),s._v("\n\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// Promise未执行的then／catch行为？")]),s._v("\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 这将决定我们如何设计then catch默认处理")]),s._v("\n"),a("span",{attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("Promise")]),s._v("("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" {\n  r()\n}).then("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" {\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"hljs-number"}},[s._v("1")]),s._v("\n}).then()\n.then("),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("r")]),s._v(" =>")]),s._v(" {\n  "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(r)\n})\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 1")]),s._v("\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("/** 当then／catch未处理会一直传递直到被处理（值穿透问题）*/")]),s._v("\n")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("blockquote",[a("p",[s._v("以示区分，使用 "),a("code",{pre:!0},[s._v("MyPromise")]),s._v(" ，本节仅实现 "),a("code",{pre:!0},[s._v("new MyPromise")]),s._v(" , "),a("code",{pre:!0},[s._v("then")]),s._v(" , "),a("code",{pre:!0},[s._v("catch")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("大致代码")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("pre",{pre:!0},[a("code",{attrs:{"v-pre":"",class:"language-JavaScript"}},[a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"hljs-title"}},[s._v("MyPromise")]),s._v(" ("),a("span",{attrs:{class:"hljs-params"}},[s._v("exector")]),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" resolve "),a("span",{attrs:{class:"hljs-comment"}},[s._v("// ...")]),s._v("\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" reject "),a("span",{attrs:{class:"hljs-comment"}},[s._v("// ...")]),s._v("\n  exector(resolve, reject)\n}\nMyPromise.prototype.then = "),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),a("span",{attrs:{class:"hljs-params"}},[s._v("onResolved, onRejected")]),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-comment"}},[s._v("// ...")]),s._v("\n}\n")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("基本思路")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ol",[a("li",[s._v("在实例调用then时状态不一定确认了，因此可能需要在更改状态时执行")]),s._v(" "),a("li",[s._v("resolve及reject由构造函数实现，函数本身只用于更改状态机和保存数据和执行可能需要执行的监听函数")]),s._v(" "),a("li",[s._v("状态一旦确认不可变更，因此需要有锁机制，我们定义三种状态，resolved rejected，pending")]),s._v(" "),a("li",[s._v("then、catch返回均是一个新的Promise实例，而其监听函数的返回Promise 不会覆盖这个 Promise")]),s._v(" "),a("li",[s._v("在执行resolve前的错误都应该被catch，反之则不应被catch")]),s._v(" "),a("li",[s._v("在then、catch未传递监听函数应该让新的实例获得其状态及数据")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("基本代码")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("pre",{pre:!0},[a("code",{attrs:{"v-pre":"",class:"language-JavaScript"}},[a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"hljs-title"}},[s._v("MyPromise")]),s._v(" ("),a("span",{attrs:{class:"hljs-params"}},[s._v("exector")]),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".status = "),a("span",{attrs:{class:"hljs-string"}},[s._v("'pending'")]),s._v("\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".onSettled = "),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("()")]),s._v(" =>")]),s._v(" {}\n  exector(\n    "),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-params"}},[s._v("data")]),s._v(" =>")]),s._v(" "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("._setState("),a("span",{attrs:{class:"hljs-string"}},[s._v("'resolved'")]),s._v(", data),\n    data => "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v("._setState("),a("span",{attrs:{class:"hljs-string"}},[s._v("'rejected'")]),s._v(", data)\n  )\n}\nMyPromise.prototype._setState = "),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),a("span",{attrs:{class:"hljs-params"}},[s._v("state, data")]),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".status === "),a("span",{attrs:{class:"hljs-string"}},[s._v("'pending'")]),s._v(") {\n    "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".status = state\n    "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".data = data\n    "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".onSettled()\n  }\n}\nMyPromise.prototype.then = "),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),a("span",{attrs:{class:"hljs-params"}},[s._v("onResolved, onRejected")]),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"hljs-built_in"}},[s._v("Promise")]),s._v("("),a("span",{attrs:{class:"hljs-function"}},[s._v("("),a("span",{attrs:{class:"hljs-params"}},[s._v("resolve, reject")]),s._v(") =>")]),s._v(" {\n    "),a("span",{attrs:{class:"hljs-comment"}},[s._v("// ...")]),s._v("\n  })\n}\n")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ol",[t("li",[this._v("返回是promise")]),this._v(" "),t("li",[this._v("值的穿透")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("pre",{pre:!0},[a("code",{attrs:{"v-pre":"",class:"language-JavaScript"}},[s._v("MyPromise.resolve = "),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),a("span",{attrs:{class:"hljs-params"}},[s._v("result")]),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" MyPromise("),a("span",{attrs:{class:"hljs-function"}},[s._v("("),a("span",{attrs:{class:"hljs-params"}},[s._v("resolve, reject")]),s._v(") =>")]),s._v(" {\n    "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (result && result.constructor === MyPromise) {\n      result.then(resolve, reject)\n    } "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n      resolve(result)\n    }\n  })\n}\nMyPromise.prototype.then = "),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),a("span",{attrs:{class:"hljs-params"}},[s._v("onResolved, onRejected")]),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".status === "),a("span",{attrs:{class:"hljs-string"}},[s._v("'pending'")]),s._v(") {\n    "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" MyPromise("),a("span",{attrs:{class:"hljs-function"}},[s._v("("),a("span",{attrs:{class:"hljs-params"}},[s._v("resolve, reject")]),s._v(") =>")]),s._v(" {\n      "),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 将 resolve reject onResolved onRejected 保持起来")]),s._v("\n    })\n  } "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".status === "),a("span",{attrs:{class:"hljs-string"}},[s._v("'resolved'")]),s._v(") {\n    "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" MyPromise.resolve(onResolved("),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".data))\n  } "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n    "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" MyPromise.reject(onRejected("),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".data))\n  }\n}\n")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ol",[t("li",[this._v("利用值的穿透、then来实现catch、finally")]),this._v(" "),t("li",[this._v("catch哪里？")]),this._v(" "),t("li",[this._v("何时异步？")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("pre",{pre:!0},[a("code",{attrs:{"v-pre":"",class:"language-JavaScript"}},[a("span",{attrs:{class:"hljs-comment"}},[s._v("// 利用值的穿透实现")]),s._v("\nMyPromise.prototype.catch = "),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),a("span",{attrs:{class:"hljs-params"}},[s._v("onRejected")]),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".then("),a("span",{attrs:{class:"hljs-literal"}},[s._v("null")]),s._v(", onRejected)\n}\nMyPromise.prototype.finally = "),a("span",{attrs:{class:"hljs-function"}},[a("span",{attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v(" ("),a("span",{attrs:{class:"hljs-params"}},[s._v("onSettled")]),s._v(") ")]),s._v("{\n  "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".then(onSettled, onSettled)\n}\n\n"),a("span",{attrs:{class:"hljs-comment"}},[s._v("// 在resolve后的错误不应该被catch，因此需要catch的地方就是exector及onResolved")]),s._v("\n")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-JavaScript"}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("第一版promise基本完成，但是还有很多和"),t("a",{attrs:{href:"https://promisesaplus.com/"}},[this._v("标准")]),this._v("不一致的地方，代码如下：")])},function(){var s=this.$createElement,t=this._self._c||s;return t("pre",{pre:!0},[t("code",{attrs:{"v-pre":"",class:"language-JavaScript"}})])}]},e=a("VU/8")(null,n,!1,null,null,null);t.default=e.exports},X4JF:function(s,t,a){s.exports=a("M4Yh")}});
//# sourceMappingURL=6.d2ef2a4e59fe902307bd.js.map